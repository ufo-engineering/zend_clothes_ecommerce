function UI_Menu(d){var e=Unit(d),area,menu,keys=[];var f=e.getAllAttributes('ui');var g=e.getByAttribute('uiMenu');var h=e.getByAttribute('uiMenuField');var j=function(){menu=Unit.filterMap(e.getByAttribute('uiMenuOption'),function(k,v,n){k=v.getAttribute('uiMenuOption'),this[(n=k.substr(k.indexOf(':')+1))]={link:(v=Unit(v)),body:(k[0]=='#'?Unit(k.substr(1)):null),text:(v.innerHTML||k),mult:Unit.parse(v.getAttribute('uiMenuValues'))},keys.push(n);v.addEvent('onclick',e.selectMenu.bind(e,n))});var s=e.selectedList=((g.value||{}).value||f.selected||'').split(',');for(var i=0;i<s.length;i++)if(keys.indexOf(s[i])<0)s.splice(i--,1);if(e.hasClass('disabled'))return e.selectMenu();if(g.group)Unit.addEvent(g.group,'onclick',e.selectMenu.bind(e,null));if(g.dropdown){Unit.disableSelection(g.dropdown);area=Unit(e.create('INPUT',{type:'text'},{style:'position:absolute;left:-10000px'}));area.addEvent('onfocus',e.openMenu.bind(e,true));e.addEvent('onclick',e.openMenu.bind(e,true));e.addEvent('onkeydown',e.searchMenu)}e.selectMenu()};e.openMenu=function(a){if(!Unit(g.dropdown))return;if((a=(a===true&&g.dropdown.hasClass('hidden')))){if(area&&document.activeElement!=area)return area.focus();setTimeout(Unit.addEvent.bind(e,document,'onclick',e.openMenu),1)}else Unit.removeEvent(document,'onclick',e.openMenu);g.dropdown.trigger(null,!a)};e.searchMenu=function(a){var i=Unit.indexOf(keys,e.selected),k=a.keyCode;if(k==38)e.selectMenu(keys[i-1<0?keys.length-1:i-1]);else if(k==40)e.selectMenu(keys[i*1+1]||keys[0]);else if([9,13,27].indexOf(k)>=0)e.openMenu();if((i=menu[e.selected])){var b=i.link.offsetTop*1,ih=i.link.offsetHeight*1;var c=g.dropdown.scrollTop*1,nh=g.dropdown.offsetHeight*1;g.dropdown.scrollTop=b<c?b:(b+ih>c+nh?b+ih-nh:c)}if(k!=9)Unit.cancelEvent(a)};e.selectMenu=function(a){var b=[],s=e.selectedList,i=Unit.indexOf(s,a),l=keys.length,m;if(menu[a])f.multiple?(i>=0?s.splice(i,1):s.push(a)):s=[a];if(a===null)s=keys.slice(0,s.length==l&&l?0:undefined);Unit.filterMap(menu,function(k,v,i){if(f.required&&!menu[s[0]])s=[k];if(i=(Unit.indexOf(s,k)>=0))b.push(v.text),m=v;if(v.link)v.link.trigger('active',i);if(v.body)v.body.trigger('hidden',!i)});e.previous=e.selected;e.selected=s.join(',');e.selectedList=s;if(m)for(var i in m.mult)if(h[i])Unit.inner(h[i],m.mult[i]);if(g.value)Unit.inner(g.value,e.selected);if(g.label)Unit.inner(g.label,b.join(', '));if(g.group)Unit.trigger(g.group,'active',s.length===l&&l>0);if(f.target)Unit.set(f.target,f.multiple?s:e.selected);if(a!==undefined){if(g.value)Unit.emitEvent(g.value,'onchange');if(f.action)Unit.exec(e,f.action,{hash:e})}};return j(),e}function UI_Form(g){var h=Unit(g);var j=h.getByAttribute('uiForm');var l=setTimeout(function(){j.config=h.getAllAttributes('ui');j.action=j.config.action;j.control=eval(j.config.control);j.scope=eval((j.config.control||'').split('.')[0]);j.rules=eval(j.config.rules);j.fields=h.getFields();j.parents=h.getByAttribute('uiField');j.elements=Unit.filterMap(j.parents,function(a,b){this[a]={parent:Unit(b),label:b.getChilds(null,'label')[0],rules:b.getAttribute('uiFieldRules'),comment:b.getChilds(null,'comment')[0],field:j.fields[a]}});h.addEvent('onchange',h.onChange);h.addEvent('onsubmit',h.onSubmit);h.validate(0)},1);h.getFields=function(){for(var i=0,f,e={};i<h.elements.length;i++)if((f=h.elements[i])&&f.name&&(f.type!='radio'||f.checked))e[f.name]=f;return e};h.getValues=function(){return Unit.filterMap(h.getFields(),function(k,v){if(!v.disabled)this[k]=v.value})};h.validate=function(e){if(j.control instanceof Function){j.control.call(j.scope,h.getValues(),e,function(d){if(!d)return h.complete();if(j.message){Unit.trigger(j.message,'error',d.type=='ERROR');Unit.trigger(j.message,'fatal',d.type=='FATAL');Unit.inner(j.message,d.message||'')}Unit.filterMap(j.elements,function(a,b,c){Unit.trigger(b.parent,'error',!!c[a])},(d.fields||{}))})}if(e==3&&j.action){h.exec(j.action,{values:h.getValues()})}};h.complete=function(){};h.onChange=function(a){h.validate(2)};h.onSubmit=function(a){h.validate(3);return Unit.cancelEvent(a)};return h}function UI_Table(c){var d=Unit(c);var e=setTimeout(function(){d.action=d.getAttribute('uiAction');d.options=Unit.parse(d.getAttribute('uiOptions'));d.orderLinks=d.getByAttribute('uiOrder');d.paginLinks=d.getByAttribute('uiPagin');if(!d.options.index)d.options.index=0;Unit.filterMap(d.orderLinks,function(a,b){Unit.addEvent(b,'onclick',d.orderTable.bind(d,a,undefined));if(a==d.options.order)Unit.addClass(b,d.options.drect==1?'orderAsc':'orderDesc')});Unit.filterMap(d.paginLinks,function(a,b){Unit.addEvent(b,'onclick',d.paginTable.bind(d,a,undefined));if(a==d.options.index)Unit.addClass(b,'active')})},1);d.orderTable=function(a,b){if(a==d.options.order)d.options.drect=b===0||d.options.drect==1?0:1;else{d.options.order=a;d.options.drect=b==undefined?1:b}d.callAction()};d.paginTable=function(a,b){if(a!==undefined)d.options.index=a;if(b!==undefined)d.options.limit=b;d.callAction()};d.callAction=function(){d.exec(d.action,{options:d.options})};return d}function UI_Wysiwyg(e){var f=Unit(e);var g=null;var h=setTimeout(function(){var a=f.getByAttribute('uiWysy');var b=Unit(a.content)||Unit(f.create('DIV'));f.value=a.value;delete a.content;delete a.value;g=document.designMode?b.create('IFRAME'):b.create('TEXTAREA');for(var i in a)Unit.addEvent(a[i],'onmousedown',f.set.bind(f,i,null));Unit.onDomReady(f.enable.bind(f,true),g)},1);f.enable=function(a){var b=f.getDocument();var c=f.getBody();var d=f.getWindow();if(a==undefined)a=true;if(b)b.designMode=a?'on':'off';if(c)c.contentEditable=a?true:false;if(c&&f.value)c.innerHTML=f.value.value;if(d)Unit.addEvent(d,'onblur',f.update)};f.getBody=function(){var a=f.getDocument();return a.body||g.getElementsByTagName('body')[0]};f.getDocument=function(){return g.document||g.contentDocument};f.getWindow=function(){return g.window||g.contentWindow};f.getContent=function(){return(f.getBody()||g).innerHTML};f.setContent=function(a){(f.getBody()||g).innerHTML=(a||'')};f.set=function(a,b){f.getDocument().execCommand(a,false,b)};f.update=function(){if(f.value)f.value.value=f.getContent()};return f}function UI_Date(e){var f=Unit(e);var g=f.getAllAttributes('ui');var h=f.getByAttribute('uiDate');var j=f.getByAttribute('uiDateDay');var k=new Date(((Unit(g.target)||{}).value||Unit.time())*1000);var l=k.getMonth();var n=k.getFullYear();var o=k.getDate();var p=setTimeout(function(){if(h.month)Unit.addEvent(h.month,'onchange',f.update);if(h.year)Unit.addEvent(h.year,'onchange',f.update);for(var i in j)Unit.addEvent(j[i],'onclick',f.select.bind(f,i));f.update()},1);f.update=function(){var m=h.month?h.month.value:l;var y=h.year?h.year.value:n;var d=new Date(y,m,1);var c=32-new Date(y,m,32).getDate();f.setClassValue('firstDay',d.getDay());f.setClassValue('monthDays',c);if(m==l&&y==n)Unit.addClass(j[o],'active');else for(var i in j)Unit.removeClass(j[i],'active')};f.select=function(a){var m=h.month?h.month.value:l;var y=h.year?h.year.value:n;var b=new Date(y,m,a).getTime()/1000;if(g.target)Unit.inner(g.target,b);if(g.action)Unit.exec(f,g.action,{time:b})};return f}function UI_Slider(d){var e=Unit(d);var f=e.getByAttribute('uiSlider');var g=parseInt(e.getAttribute('uiSliderStep'))||1;var h=parseInt(e.getAttribute('uiSliderTime'))||0;var j=setTimeout(function(){f.links=e.getByAttribute('uiSliderLink');f.items=e.getByAttribute('uiSliderItem');for(var i in f.links)Unit.addEvent(f.links[i],'onclick',e.moveScroll.bind(e,i));if(f.prev)Unit(f.prev).addEvent('onclick',e.moveScroll.bind(e,false));if(f.next)Unit(f.next).addEvent('onclick',e.moveScroll.bind(e,true));if(Unit.keys(f.items).length<=g){Unit.trigger(f.prev,'hidden',true);Unit.trigger(f.next,'hidden',true)}else e.moveScroll(0)},1);e.moveScroll=function(a){var b=Unit.keys(f.items);if(a===true)f.index+=g;else if(a===false)f.index-=g;else f.index=a;if(f.index>b.length-g)f.index=0;else if(f.index<=0)f.index=0;var c=b[f.index];if(f.items[c]&&f.body)f.body.style.left=-f.items[c].offsetLeft+'px';for(var i in f.links){if(c===i)Unit.addClass(f.links[i],'active');else Unit.removeClass(f.links[i],'active')}if(h){if(f.timeout)clearTimeout(f.timeout);f.timeout=setTimeout(e.moveScroll.bind(e,true),h)}};return e}function UI_Selecter(c){var d=Unit(c);var f=d.getAllAttributes('uiselecter');var g=d.getByAttribute('uiSelecter');var h={};var i=setTimeout(function(){if(g.min)Unit.addEvent(g.min,'onmousedown',d.startDrag.bind(d,g.min));if(g.max)Unit.addEvent(g.max,'onmousedown',d.startDrag.bind(d,g.max));var a=f.min,max=f.max;if(g.minValue)a=Unit(g.minValue).value;if(g.maxValue)max=Unit(g.maxValue).value;h.limit=g.bar?g.bar.offsetWidth:0;f.all=f.max-f.min;d.setDragPosition(a,max)},1);d.startDrag=function(a,e){h.startX=e.clientX-a.offsetLeft;h.target=a;if(a==g.min)h.min=0,h.max=g.max.offsetLeft;if(a==g.max)h.min=g.min.offsetLeft,h.max=h.limit;Unit.addEvent(document,'onmouseup',d.stopDrag);Unit.addEvent(document,'onmousemove',d.processDrag);Unit.addClass(document.body,'noselect');return Unit.cancelEvent(e)};d.stopDrag=function(e){Unit.removeEvent(document,'onmouseup',d.stopDrag);Unit.removeEvent(document,'onmousemove',d.processDrag);Unit.removeClass(document.body,'noselect');d.callAction()};d.processDrag=function(e){var l=e.clientX-h.startX;if(l<h.min)l=h.min;if(l>h.max)l=h.max;var a=g.min.offsetLeft,max=g.max.offsetLeft;if(h.target==g.min)a=l;if(h.target==g.max)max=l;d.setDragPositionPx(a,max)};d.setDragPositionPx=function(a,b){if(g.min)g.min.style.left=a+'px';if(g.max)g.max.style.left=b+'px';if(g.cur){g.cur.style.left=a+'px';g.cur.style.width=(b-a)+'px'}if(g.minValue)Unit.inner(g.minValue,Math.round(f.all/h.limit*a));if(g.maxValue)Unit.inner(g.maxValue,Math.round(f.all/h.limit*b))};d.setDragPosition=function(a,b){d.setDragPositionPx(Math.round(h.limit/f.all*a),Math.round(h.limit/f.all*b))};d.callAction=function(){var a=d.getAttribute('uiAction');if(a)d.exec(a,{})};return d}function UI_Trigger(b){var c=Unit(b);var d=c.getAllAttributes('ui');var e=setTimeout(function(){c.addEvent('onclick',c.collapse.bind(c,undefined));var a=Unit.getCookie('trigger:'+d.target);if(a!==undefined)c.collapse(a==='true')},1);c.collapse=function(a){Unit.setCookie('trigger:'+d.target,Unit.trigger(c,'inactive',Unit.trigger(d.target,'hidden',a)))};return c}function UI_Preview(c){var d=Unit(c);var f=d.getAllAttributes('ui');var g=d.getByAttribute('uiPreview');var h=setTimeout(function(){for(var i in g)Unit.addEvent(g[i],'onclick',d.show.bind(d,i))},1);d.show=function(a,e){if(!d.root)d.generatePopup();var b=Unit.keys(d.clip);if(a===true)d.selected++;else if(a===false)d.selected--;else d.selected=b.indexOf(a);if(d.selected>=b.length-1)d.selected=b.length-1;if(d.selected<=0)d.selected=0;Unit.trigger(d.next,'disabled',(d.selected>=b.length-1));Unit.trigger(d.prev,'disabled',(d.selected<=0));a=b[d.selected];for(var i in d.clip){Unit.trigger(d.clip[i],'hidden',i!=a)}return Unit.cancelEvent(e)};d.close=function(){if(d.root){Unit.remove(d.root);d.root=null}};d.generatePopup=function(){var a=Math.round(Unit.pageSize().height*0.8);d.clip={};d.root=Unit.create(document.body,'DIV',{className:'ui_preview'});d.back=Unit.create(d.root,'DIV',{className:'back'});d.body=Unit.create(d.root,'DIV',{className:'body',style:'max-height:'+a+'px'});d.prev=Unit.create(d.body,'DIV',{className:'prev'});d.next=Unit.create(d.body,'DIV',{className:'next'});d.drop=Unit.create(d.body,'DIV',{className:'drop'});Unit.addEvent(d.back,'onclick',d.close);Unit.addEvent(d.drop,'onclick',d.close);Unit.addEvent(d.prev,'onclick',d.show.bind(d,false));Unit.addEvent(d.next,'onclick',d.show.bind(d,true));for(var i in g){d.clip[i]=Unit.create(d.body,'DIV',{className:'item',innerHTML:'<img src="'+i+'" style="max-height:'+a+'px;">'})}};return d}